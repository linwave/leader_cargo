{% load custom_filters %}
<input type="hidden" id="total-pages" value="{{ paginated_queryset.paginator.num_pages }}">
<div class="container-fluid">
    <div class="row mb-2">
  <div class="col-12 d-flex justify-content-between align-items-center">
      <div class="small text-muted">
          Показано: <span class="fw-semibold">{{ page_current }}</span>
          из <span class="fw-semibold">{{ filtered_total }}</span> найденных звонков
      </div>
      <span class="badge text-bg-secondary">{{ page_current }} / {{ filtered_total }}</span>
  </div>
</div>
    <div class="row">
        <div class="col-12">
            <div class="table-responsive" style="border: 1px solid #000;
            overflow-y: auto;overflow-x: auto;height: 68vh;">
                <table class="table align-middle table-hover g-1"
                       style="font-size: 0.8rem;">
                    <thead class="table-dark " style="position: sticky;top: 0;left: 0;z-index: 10;">
                    <tr style="vertical-align: middle;">
                        <th width="10" scope="col">#</th>
                        <th scope="col">Оператор</th>
                        <th scope="col">CRM</th>
                        <th scope="col">Лет на рынке</th>
                        <th scope="col">Статус</th>
                        <th scope="col">Имя клиента</th>
                        <th scope="col">Контактный номер</th>
                        <th scope="col">Город клиента</th>
                        <th scope="col">Лояльность</th>
                        <th scope="col">Комментарий по звонку</th>
                        <th scope="col">Дата следующего звонка</th>
                        <th scope="col">Ответственный менеджер</th>
                        <th scope="col">Дата передачи менеджеру</th>
                    </tr>
                    </thead>
                    <tbody class="table-light">
                    {% for call in paginated_queryset %}
                    <tr data-bs-toggle="modal"
                        data-bs-target="#hx-modal"
                        hx-get="{% url 'main:edit_calls' call.pk %}"
                        hx-target="#hx-modal-body"
                        id="call_{{ call.id }}"
                        style="cursor: pointer;">
                        <th scope="row">{{ call.pk }}</th>
                        <td>{{ call.operator.get_FI|default:"" }}</td>
                        <td>{% if call.crm %}{{ call.crm }}{% else %}{{ call.call_file.get_crm_display }}{%endif%}</td>
                        <td>
                            {% if call.work_years %}
                            {{ call.work_years }} {{ call.work_years|pluralize_ru:"год,года,лет" }}
                            {% if call.date_registration %}
                            <br><small class="text-muted">с {{ call.date_registration|date:"d.m.Y" }}</small>
                            {% endif %}
                            {% endif %}
                        </td>
                        <td>{{ call.status_call|default:"" }}</td>
                        <td>
                            {{ call.client_name|default:"" }}
                            {% if call.seller_page %}
                            <br><a href="{{ call.seller_page }}" target="_blank" class="text-primary small" style="word-break: break-all;">
                            {{ call.seller_page }}
                        </a>
                            {% endif %}
                        </td>

                        <td>{{ call.client_phone|default:"" }}</td>
                        <td>{{ call.client_location|default:"" }}</td>
                        <td>{{ call.get_loyalty_display|default:"" }}</td>
                        <td>{{ call.description|default:"" }}</td>
                        <td>{{ call.date_next_call|default:"" }}</td>
                        <td>{{ call.manager.get_FI|default:"" }}</td>
                        <td>{{ call.date_to_manager|default:"" }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- Пагинация -->
{% if paginated_queryset.paginator.num_pages != 1 %}
<div class="pagination">
        <span class="page-links">
            {% if paginated_queryset.has_previous %}
                <a href="?page=1&{{ request.GET|urlencode_after_remove:'page' }}" class="page-link">&laquo; 1</a>
                <a href="?page={{ paginated_queryset.previous_page_number }}&{{ request.GET|urlencode_after_remove:'page' }}" class="page-link"><</a>
            {% endif %}
            {% for i in page_range_ %}
                {% if paginated_queryset.number == i %}
                    <span class="current-page page-link">{{ i }}</span>
                {% else %}
                    <a href="?page={{ i }}&{{ request.GET|urlencode_after_remove:'page' }}" class="page-link">{{ i }}</a>
                {% endif %}
            {% endfor %}
            {% if paginated_queryset.has_next %}
                <a href="?page={{ paginated_queryset.next_page_number }}&{{ request.GET|urlencode_after_remove:'page' }}" class="page-link">></a>
                <a href="?page={{ paginated_queryset.paginator.num_pages }}&{{ request.GET|urlencode_after_remove:'page' }}" class="page-link">{{ paginated_queryset.paginator.num_pages }} &raquo;</a>
            {% endif %}
            <input type="number" id="pageInput" min="1" max="{{ paginated_queryset.paginator.num_pages }}" value="{{ paginated_queryset.number }}" class="form-control form-control-sm d-inline-block p-2" style="width: 65px;">
            <button id="goToPage" class="btn btn-sm btn-primary">Перейти</button>
        </span>
</div>
{% endif %}